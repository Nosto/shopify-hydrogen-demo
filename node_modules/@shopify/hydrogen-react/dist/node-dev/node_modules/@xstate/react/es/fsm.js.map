{"version":3,"file":"fsm.js","sources":["../../../../../../../../node_modules/@xstate/react/es/fsm.js"],"sourcesContent":["var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { createMachine, interpret, InterpreterStatus } from '@xstate/fsm';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\nimport { useSyncExternalStoreWithSelector } from 'use-sync-external-store/shim/with-selector';\nimport useConstant from './useConstant';\nfunction identity(a) {\n    return a;\n}\nvar getServiceState = function (service) {\n    var currentValue;\n    service\n        .subscribe(function (state) {\n        currentValue = state;\n    })\n        .unsubscribe();\n    return currentValue;\n};\nexport function useMachine(stateMachine, options) {\n    var persistedStateRef = useRef();\n    if (process.env.NODE_ENV !== 'production') {\n        var _a = __read(useState(stateMachine), 1), initialMachine = _a[0];\n        if (stateMachine !== initialMachine) {\n            console.warn('Machine given to `useMachine` has changed between renders. This is not supported and might lead to unexpected results.\\n' +\n                'Please make sure that you pass the same Machine as argument each time.');\n        }\n    }\n    var _b = __read(useConstant(function () {\n        var queue = [];\n        var service = interpret(createMachine(stateMachine.config, options ? options : stateMachine._options));\n        var send = service.send;\n        service.send = function (event) {\n            if (service.status === InterpreterStatus.NotStarted) {\n                queue.push(event);\n                return;\n            }\n            send(event);\n            persistedStateRef.current = service.state;\n        };\n        return [service, queue];\n    }), 2), service = _b[0], queue = _b[1];\n    useIsomorphicLayoutEffect(function () {\n        if (options) {\n            service._machine._options = options;\n        }\n    });\n    var useServiceResult = useService(service);\n    useEffect(function () {\n        service.start(persistedStateRef.current);\n        queue.forEach(service.send);\n        persistedStateRef.current = service.state;\n        return function () {\n            service.stop();\n        };\n    }, []);\n    return useServiceResult;\n}\nvar isEqual = function (_prevState, nextState) { return nextState.changed === false; };\nexport function useService(service) {\n    var getSnapshot = useCallback(function () { return getServiceState(service); }, [service]);\n    var subscribe = useCallback(function (handleStoreChange) {\n        var unsubscribe = service.subscribe(handleStoreChange).unsubscribe;\n        return unsubscribe;\n    }, [service]);\n    var storeSnapshot = useSyncExternalStoreWithSelector(subscribe, getSnapshot, getSnapshot, identity, isEqual);\n    return [storeSnapshot, service.send, service];\n}\n"],"names":["useRef","useState","queue","service","interpret","createMachine","InterpreterStatus","useEffect","useCallback","useSyncExternalStoreWithSelector"],"mappings":";;;;;;;AAAA,IAAI,SAAkC,SAAU,GAAG,GAAG;AAClD,MAAI,IAAI,OAAO,WAAW,cAAc,EAAE,OAAO,QAAQ;AACzD,MAAI,CAAC,EAAG,QAAO;AACf,MAAI,IAAI,EAAE,KAAK,CAAC,GAAG,GAAG,KAAK,CAAA,GAAI;AAC/B,MAAI;AACA,YAAQ,MAAM,UAAU,MAAM,MAAM,EAAE,IAAI,EAAE,KAAI,GAAI,KAAM,IAAG,KAAK,EAAE,KAAK;AAAA,EAC7E,SACO,OAAO;AAAE,QAAI,EAAE,MAAY;AAAA,EAAI,UAC1C;AACQ,QAAI;AACA,UAAI,KAAK,CAAC,EAAE,SAAS,IAAI,EAAE,QAAQ,GAAI,GAAE,KAAK,CAAC;AAAA,IACnD,UACR;AAAkB,UAAI,EAAG,OAAM,EAAE;AAAA,IAAO;AAAA,EACpC;AACA,SAAO;AACX;AAMA,SAAS,SAAS,GAAG;AACjB,SAAO;AACX;AACA,IAAI,kBAAkB,SAAU,SAAS;AACrC,MAAI;AACJ,UACK,UAAU,SAAU,OAAO;AAC5B,mBAAe;AAAA,EACnB,CAAC,EACI,YAAW;AAChB,SAAO;AACX;AACO,SAAS,WAAW,cAAc,SAAS;AAC9C,MAAI,oBAAoBA,MAAAA,OAAM;AAC9B,MAAI,QAAQ,IAAI,aAAa,cAAc;AACvC,QAAI,KAAK,OAAOC,MAAAA,SAAS,YAAY,GAAG,CAAC,GAAG,iBAAiB,GAAG,CAAC;AACjE,QAAI,iBAAiB,gBAAgB;AACjC,cAAQ,KAAK,gMAC+D;AAAA,IAChF;AAAA,EACJ;AACA,MAAI,KAAK,OAAO,YAAY,WAAY;AACpC,QAAIC,SAAQ,CAAA;AACZ,QAAIC,WAAUC,gBAAUC,MAAAA,cAAc,aAAa,QAAQ,UAAU,UAAU,aAAa,QAAQ,CAAC;AACrG,QAAI,OAAOF,SAAQ;AACnB,IAAAA,SAAQ,OAAO,SAAU,OAAO;AAC5B,UAAIA,SAAQ,WAAWG,MAAAA,kBAAkB,YAAY;AACjD,QAAAJ,OAAM,KAAK,KAAK;AAChB;AAAA,MACJ;AACA,WAAK,KAAK;AACV,wBAAkB,UAAUC,SAAQ;AAAA,IACxC;AACA,WAAO,CAACA,UAASD,MAAK;AAAA,EAC1B,CAAC,GAAG,CAAC,GAAG,UAAU,GAAG,CAAC,GAAG,QAAQ,GAAG,CAAC;AACrC,4BAA0B,WAAY;AAClC,QAAI,SAAS;AACT,cAAQ,SAAS,WAAW;AAAA,IAChC;AAAA,EACJ,CAAC;AACD,MAAI,mBAAmB,WAAW,OAAO;AACzCK,QAAAA,UAAU,WAAY;AAClB,YAAQ,MAAM,kBAAkB,OAAO;AACvC,UAAM,QAAQ,QAAQ,IAAI;AAC1B,sBAAkB,UAAU,QAAQ;AACpC,WAAO,WAAY;AACf,cAAQ,KAAI;AAAA,IAChB;AAAA,EACJ,GAAG,CAAA,CAAE;AACL,SAAO;AACX;AACA,IAAI,UAAU,SAAU,YAAY,WAAW;AAAE,SAAO,UAAU,YAAY;AAAO;AAC9E,SAAS,WAAW,SAAS;AAChC,MAAI,cAAcC,kBAAY,WAAY;AAAE,WAAO,gBAAgB,OAAO;AAAA,EAAG,GAAG,CAAC,OAAO,CAAC;AACzF,MAAI,YAAYA,kBAAY,SAAU,mBAAmB;AACrD,QAAI,cAAc,QAAQ,UAAU,iBAAiB,EAAE;AACvD,WAAO;AAAA,EACX,GAAG,CAAC,OAAO,CAAC;AACZ,MAAI,gBAAgBC,aAAAA,oBAAAA,iCAAiC,WAAW,aAAa,aAAa,UAAU,OAAO;AAC3G,SAAO,CAAC,eAAe,QAAQ,MAAM,OAAO;AAChD;;;","x_google_ignoreList":[0]}