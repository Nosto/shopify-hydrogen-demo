# DEVELOPMENT

These types for Oxygen are created by taking the appropriate `index.d.ts` files from `@cloudflare/workers-types` (in their respective subfolder per compatibilty date) and removing classes, interfaces, types, etc that are not supported on Oxygen, using various transforms defined in the `transforms.ts` file.

The bundled compatibility dates this package provides are specified in the `compatibilityDates` array in `create-types.ts`. Running `npm run parse` will run this file, which in turn will:
- parse the type declaration files supplied by Cloudflare, filtering unwanted types
- write a type declaration file into the `types/<compatibility-date>` subfolder
- lint the created file with `prettier`
- create a `tsconfig.json` file in the subfolder
- run `tsc` with the created `tsconfig.json` file to ensure the tests compile against the created type definition file
- add the declaration file to the package's exports in `package.json`

In addition, running `npm run generate:docs` will create typedocs for each created type declaration file, in the `docs` folder. These two steps are exexecuted automatically using the `prepublishOnly` lifecycle script prior to publishing the package.

## Publishing a package

Follow these steps:

1. PRs targeting the `main` branch will need to contain a changeset file. Run `npx changeset add` to create one.
2. Merge your PR into the `main` branch. This will trigger a release with the tag `@unstable` on NPM. The version number for the unstable release will be in the format `unstable.YYYYMMDDHHMM`, where `YYYYMMDDHHMM` is the UTC timestamp of when the release was created.
3. In addition, after the merge a `Version Packages` PR will be created (or updated, if such a PR already exists). This PR will contain all the changesets with the updated versions of the package.
4. To create a stable release, merge the `Version Packages` PR. This will trigger a release to NPM with the appropriate version updates.

