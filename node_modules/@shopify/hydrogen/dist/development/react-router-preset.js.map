{"version":3,"sources":["../../src/react-router-preset.ts"],"sourcesContent":["import type {Preset} from '@react-router/dev/config';\n\n/**\n * Official Hydrogen Preset for React Router 7.9.x\n *\n * Provides optimal React Router configuration for Hydrogen applications on Oxygen.\n * Enables validated performance optimizations while ensuring CLI compatibility.\n *\n * React Router 7.9.x Feature Support Matrix for Hydrogen 2025.7.0\n *\n * +----------------------------------+----------+----------------------------------+\n * | Feature                          | Status   | Notes                            |\n * +----------------------------------+----------+----------------------------------+\n * | CORE CONFIGURATION                                                              |\n * +----------------------------------+----------+----------------------------------+\n * | appDirectory: 'app'              | Enabled  | Core application structure       |\n * | buildDirectory: 'dist'           | Enabled  | Build output configuration       |\n * | ssr: true                        | Enabled  | Server-side rendering            |\n * +----------------------------------+----------+----------------------------------+\n * | PERFORMANCE FLAGS                                                               |\n * +----------------------------------+----------+----------------------------------+\n * | unstable_optimizeDeps            | Enabled  | Build performance optimization   |\n * | v8_middleware                    | Enabled  | Required for Hydrogen context    |\n * | unstable_splitRouteModules       | Enabled  | Route code splitting             |\n * +----------------------------------+----------+----------------------------------+\n * | ROUTE DISCOVERY                                                                 |\n * +----------------------------------+----------+----------------------------------+\n * | routeDiscovery: { mode: 'lazy' } | Default  | Lazy route loading               |\n * | routeDiscovery: { mode: 'init' } | Allowed  | Eager route loading              |\n * +----------------------------------+----------+----------------------------------+\n * | UNSUPPORTED FEATURES                                                            |\n * +----------------------------------+----------+----------------------------------+\n * | basename: '/path'                | Blocked  | CLI infrastructure limitation    |\n * | prerender: ['/routes']           | Blocked  | Plugin incompatibility           |\n * | serverBundles: () => {}          | Blocked  | Manifest incompatibility         |\n * | buildEnd: () => {}               | Blocked  | CLI bypasses hook execution      |\n * | unstable_subResourceIntegrity    | Blocked  | CSP nonce/hash conflict          |\n * | unstable_viteEnvironmentApi      | Blocked  | CLI fallback detection used      |\n * +----------------------------------+----------+----------------------------------+\n *\n * @version 2025.7.0\n */\nexport function hydrogenPreset(): Preset {\n  return {\n    name: 'hydrogen-2025.7.0',\n\n    reactRouterConfig: () => ({\n      appDirectory: 'app',\n      buildDirectory: 'dist',\n      ssr: true,\n\n      future: {\n        v8_middleware: true,\n        unstable_optimizeDeps: true,\n        unstable_splitRouteModules: true,\n        unstable_subResourceIntegrity: false,\n        unstable_viteEnvironmentApi: false,\n      },\n    }),\n\n    reactRouterConfigResolved: ({reactRouterConfig}) => {\n      if (reactRouterConfig.basename && reactRouterConfig.basename !== '/') {\n        throw new Error(\n          '[Hydrogen Preset] basename is not supported in Hydrogen 2025.7.0.\\n' +\n            'Reason: Requires major CLI infrastructure modernization.\\n' +\n            'Workaround: Use reverse proxy or CDN path rewriting for subdirectory hosting.',\n        );\n      }\n\n      if (reactRouterConfig.prerender) {\n        throw new Error(\n          '[Hydrogen Preset] prerender is not supported in Hydrogen 2025.7.0.\\n' +\n            'Reason: React Router plugin incompatibility with Hydrogen CLI build pipeline.\\n' +\n            'Workaround: Use external static generation tools or server-side caching.',\n        );\n      }\n\n      if (reactRouterConfig.serverBundles) {\n        throw new Error(\n          '[Hydrogen Preset] serverBundles is not supported in Hydrogen 2025.7.0.\\n' +\n            'Reason: React Router plugin manifest incompatibility with Hydrogen CLI.\\n' +\n            'Alternative: Route-level code splitting via unstable_splitRouteModules is enabled.',\n        );\n      }\n\n      if (reactRouterConfig.buildEnd) {\n        throw new Error(\n          '[Hydrogen Preset] buildEnd is not supported in Hydrogen 2025.7.0.\\n' +\n            'Reason: Hydrogen CLI bypasses React Router buildEnd hook execution.\\n' +\n            'Workaround: Use external build scripts or package.json post-build hooks.',\n        );\n      }\n\n      if (reactRouterConfig.future?.unstable_subResourceIntegrity === true) {\n        throw new Error(\n          '[Hydrogen Preset] unstable_subResourceIntegrity cannot be enabled.\\n' +\n            'Reason: Conflicts with Hydrogen CSP nonce-based authentication.\\n' +\n            'Impact: Would break Content Security Policy and cause script execution failures.',\n        );\n      }\n    },\n  };\n}\n"],"mappings":";AA0CO,SAAS,iBAAyB;AACvC,SAAO;AAAA,IACL,MAAM;AAAA,IAEN,mBAAmB,OAAO;AAAA,MACxB,cAAc;AAAA,MACd,gBAAgB;AAAA,MAChB,KAAK;AAAA,MAEL,QAAQ;AAAA,QACN,eAAe;AAAA,QACf,uBAAuB;AAAA,QACvB,4BAA4B;AAAA,QAC5B,+BAA+B;AAAA,QAC/B,6BAA6B;AAAA,MAC/B;AAAA,IACF;AAAA,IAEA,2BAA2B,CAAC,EAAC,kBAAiB,MAAM;AAClD,UAAI,kBAAkB,YAAY,kBAAkB,aAAa,KAAK;AACpE,cAAM,IAAI;AAAA,UACR;AAAA,QAGF;AAAA,MACF;AAEA,UAAI,kBAAkB,WAAW;AAC/B,cAAM,IAAI;AAAA,UACR;AAAA,QAGF;AAAA,MACF;AAEA,UAAI,kBAAkB,eAAe;AACnC,cAAM,IAAI;AAAA,UACR;AAAA,QAGF;AAAA,MACF;AAEA,UAAI,kBAAkB,UAAU;AAC9B,cAAM,IAAI;AAAA,UACR;AAAA,QAGF;AAAA,MACF;AAEA,UAAI,kBAAkB,QAAQ,kCAAkC,MAAM;AACpE,cAAM,IAAI;AAAA,UACR;AAAA,QAGF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;","names":[]}