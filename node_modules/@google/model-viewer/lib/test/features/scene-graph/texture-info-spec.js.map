{"version":3,"file":"texture-info-spec.js","sourceRoot":"","sources":["../../../../src/test/features/scene-graph/texture-info-spec.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {expect} from 'chai';\n\nimport {TextureInfo} from '../../../features/scene-graph/texture-info.js';\nimport {ModelViewerElement} from '../../../model-viewer.js';\nimport {waitForEvent} from '../../../utilities.js';\nimport {assetPath} from '../../helpers.js';\n\nconst DUCK_GLB_PATH =\n    assetPath('models/glTF-Sample-Assets/Models/Duck/glTF-Binary/Duck.glb');\nconst TEXTURED_CUBE_GLB_PATH = assetPath(\n    'models/glTF-Sample-Assets/Models/BoxTextured/glTF-Binary/BoxTextured.glb');\n\nsuite('scene-graph/texture-info', () => {\n  suite('texture-info', () => {\n    let element: ModelViewerElement;\n    let emptyTextureInfo: TextureInfo;\n    let baseTextureInfo: TextureInfo;\n\n    setup(async () => {\n      element = new ModelViewerElement();\n      element.src = DUCK_GLB_PATH;\n      document.body.insertBefore(element, document.body.firstChild);\n      await waitForEvent(element, 'load');\n\n      emptyTextureInfo = element.model!.materials[0].normalTexture;\n      baseTextureInfo =\n          element.model!.materials[0].pbrMetallicRoughness.baseColorTexture;\n    });\n\n    teardown(() => {\n      document.body.removeChild(element);\n    });\n\n    test('empty slot is null', async () => {\n      // The duck doesn't have a normal texture.\n      expect(emptyTextureInfo.texture).to.be.null;\n    });\n\n    test('non-empty slot is not null', async () => {\n      // The duck doesn't have a normal texture.\n      expect(baseTextureInfo.texture).to.not.be.null;\n    });\n\n    test('call setTexture', async () => {\n      const texture = await element.createTexture(assetPath(\n          'models/glTF-Sample-Assets/Models/BoxTextured/glTF/CesiumLogoFlat.png'));\n\n      // Setting a texture, the normal texture should _not_ be null.\n      emptyTextureInfo.setTexture(texture);\n      expect(emptyTextureInfo.texture).to.not.be.null;\n\n      // Clearing a texture, the normal texture _should_ be null again.\n      emptyTextureInfo.setTexture(null);\n      expect(emptyTextureInfo.texture).to.be.null;\n    });\n\n    test(\n        'exports and re-imports the model with transformed texture',\n        async () => {\n          // Load textured glb.\n          element.src = TEXTURED_CUBE_GLB_PATH;\n          await waitForEvent(element, 'load');\n\n          // Transform the textures.\n          const sampler = element.model?.materials[0]\n                              .pbrMetallicRoughness['baseColorTexture']\n                              .texture?.sampler!;\n          sampler.setRotation(0.1);\n          sampler.setOffset({u: 0.2, v: 0.3});\n          sampler.setScale({u: 0.4, v: 0.5});\n\n          // Export model.\n          const exported = await element.exportScene({binary: true});\n          const url = URL.createObjectURL(exported);\n\n          // Re-load model.\n          element.src = url;\n          await waitForEvent(element, 'load');\n\n          URL.revokeObjectURL(url);\n\n          const exported_sampler = element.model?.materials[0]\n                                       .pbrMetallicRoughness['baseColorTexture']\n                                       .texture?.sampler!;\n          expect(exported_sampler.rotation).to.be.eq(0.1, 'rotation');\n          expect(exported_sampler.offset!.u).to.be.eql(0.2, 'offset_u');\n          expect(exported_sampler.offset!.v).to.be.eql(0.3, 'offset_v');\n          expect(exported_sampler.scale!.u).to.be.eql(0.4, 'scale_u');\n          expect(exported_sampler.scale!.v).to.be.eql(0.5, 'scale_v');\n        });\n  });\n});\n"]}