{"version":3,"file":"utilities.js","sourceRoot":"","sources":["../src/utilities.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {HAS_WEBXR_DEVICE_API, HAS_WEBXR_HIT_TEST_API, IS_WEBXR_AR_CANDIDATE} from './constants.js';\n\nexport type Constructor<T = object, U = object> = {\n  new (...args: any[]): T,\n  prototype: T\n}&U;\n\nexport const deserializeUrl = (url: string|null): string|null =>\n    (!!url && url !== 'null') ? toFullUrl(url) : null;\n\n\nexport const assertIsArCandidate = () => {\n  if (IS_WEBXR_AR_CANDIDATE) {\n    return;\n  }\n\n  const missingApis = [];\n\n  if (!HAS_WEBXR_DEVICE_API) {\n    missingApis.push('WebXR Device API');\n  }\n\n  if (!HAS_WEBXR_HIT_TEST_API) {\n    missingApis.push('WebXR Hit Test API');\n  }\n\n  throw new Error(\n      `The following APIs are required for AR, but are missing in this browser: ${\n          missingApis.join(', ')}`);\n};\n\n\n/**\n * Converts a partial URL string to a fully qualified URL string.\n *\n * @param {String} url\n * @return {String}\n */\nexport const toFullUrl = (partialUrl: string): string => {\n  const url = new URL(partialUrl, window.location.toString());\n  return url.toString();\n};\n\n\n/**\n * Returns a throttled version of a given function that is only invoked at most\n * once within a given threshold of time in milliseconds.\n *\n * The throttled version of the function has a \"flush\" property that resets the\n * threshold for cases when immediate invocation is desired.\n */\nexport const throttle = (fn: (...args: Array<any>) => any, ms: number) => {\n  let timer: number|null = null;\n\n  const throttled = (...args: Array<any>) => {\n    if (timer != null) {\n      return;\n    }\n\n    fn(...args);\n\n    timer = self.setTimeout(() => timer = null, ms);\n  };\n\n  throttled.flush = () => {\n    if (timer != null) {\n      self.clearTimeout(timer);\n      timer = null;\n    }\n  };\n\n  return throttled;\n};\n\nexport const debounce = (fn: (...args: Array<any>) => any, ms: number) => {\n  let timer: number|null = null;\n\n  return (...args: Array<any>) => {\n    if (timer != null) {\n      self.clearTimeout(timer);\n    }\n\n    timer = self.setTimeout(() => {\n      timer = null;\n      fn(...args);\n    }, ms);\n  };\n};\n\n\n/**\n * @param {Number} edge\n * @param {Number} value\n * @return {Number} 0 if value is less than edge, otherwise 1\n */\nexport const step = (edge: number, value: number): number => {\n  return value < edge ? 0 : 1;\n};\n\n\n/**\n * @param {Number} value\n * @param {Number} lowerLimit\n * @param {Number} upperLimit\n * @return {Number} value clamped within lowerLimit..upperLimit\n */\nexport const clamp =\n    (value: number, lowerLimit: number, upperLimit: number): number =>\n        Math.max(lowerLimit, Math.min(upperLimit, value));\n\n/**\n * Debug mode is enabled when one of the two following conditions is true:\n *\n *  1. A 'model-viewer-debug-mode' query parameter is present in the current\n *     search string\n *  2. There is a global object ModelViewerElement with a debugMode property set\n *     to true\n */\nexport const isDebugMode = (() => {\n  const debugQueryParameterName = 'model-viewer-debug-mode';\n  const debugQueryParameter = new RegExp(`[?&]${debugQueryParameterName}(&|$)`);\n\n  return () => ((self as any).ModelViewerElement &&\n                (self as any).ModelViewerElement.debugMode) ||\n      (self.location && self.location.search &&\n       self.location.search.match(debugQueryParameter));\n})();\n\nexport type PredicateFunction<T = void> = (value: T) => boolean;\n\nexport const timePasses = (ms: number = 0): Promise<void> =>\n    new Promise(resolve => setTimeout(resolve, ms));\n\n/**\n * @param {EventTarget|EventDispatcher} target\n * @param {string} eventName\n * @param {?Function} predicate\n */\nexport const waitForEvent =\n    <T>(target: any,\n        eventName: string,\n        predicate: PredicateFunction<T>|null = null): Promise<T> =>\n        new Promise(resolve => {\n          function handler(event: T) {\n            if (!predicate || predicate(event)) {\n              resolve(event);\n              target.removeEventListener(eventName, handler);\n            }\n          }\n          target.addEventListener(eventName, handler);\n        });"]}